<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=content-language content="en"><meta name=author content="Karun Ramakrishnan"><meta name=description content="Live Templates have made my programming life a lot easier. There is a lot of boilerplate code that we type every single day. I like using Groovy script to build some powerful Scala live templates.
Unfortunately the documentation for this is almost non existent. Oh well!
I ended up looking at the IntelliJ Scala plugin’s source to find the available variables for live templates. You can see it here - IntelliJ live template variables"><meta name=keywords content="blog,developer,personal"><meta name=twitter:card content="summary"><meta name=twitter:title content="IntelliJ Live Templates With Groovy Script"><meta name=twitter:description content="Live Templates have made my programming life a lot easier. There is a lot of boilerplate code that we type every single day. I like using Groovy script to build some powerful Scala live templates.
Unfortunately the documentation for this is almost non existent. Oh well!
I ended up looking at the IntelliJ Scala plugin’s source to find the available variables for live templates. You can see it here - IntelliJ live template variables"><meta property="og:title" content="IntelliJ Live Templates With Groovy Script"><meta property="og:description" content="Live Templates have made my programming life a lot easier. There is a lot of boilerplate code that we type every single day. I like using Groovy script to build some powerful Scala live templates.
Unfortunately the documentation for this is almost non existent. Oh well!
I ended up looking at the IntelliJ Scala plugin’s source to find the available variables for live templates. You can see it here - IntelliJ live template variables"><meta property="og:type" content="article"><meta property="og:url" content="https://www.karun.dev/posts/intellij-live-templates-scala/"><meta property="article:published_time" content="2022-08-05T19:00:00-07:00"><meta property="article:modified_time" content="2022-08-05T19:00:00-07:00"><base href=https://www.karun.dev/posts/intellij-live-templates-scala/><title>IntelliJ Live Templates With Groovy Script · Karun Ramakrishnan</title><link rel=canonical href=https://www.karun.dev/posts/intellij-live-templates-scala/><link href="https://fonts.googleapis.com/css?family=Lato:400,700%7CMerriweather:300,700%7CSource+Code+Pro:400,700&display=swap" rel=stylesheet><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.13.0/css/all.css integrity=sha384-Bfad6CLCknfcloXFOyFnlgtENryhrpZCe29RTifKEixXQZ38WheV+i/6YWSzkz3V crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css integrity="sha256-l85OmPOjvil/SOvVt3HnSSjzF1TUMyT9eV0c2BzEGzU=" crossorigin=anonymous><link rel=stylesheet href=https://www.karun.dev/css/coder.min.a4f332213a21ce8eb521670c614470c58923aaaf385e2a73982c31dd7642decb.css integrity="sha256-pPMyITohzo61IWcMYURwxYkjqq84XipzmCwx3XZC3ss=" crossorigin=anonymous media=screen><link rel=icon type=image/png href=https://www.karun.dev/images/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=https://www.karun.dev/images/favicon-16x16.png sizes=16x16><meta name=generator content="Hugo 0.71.1"></head><body class=colorscheme-light><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=https://www.karun.dev/>Karun Ramakrishnan</a>
<input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fas fa-bars"></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=https://www.karun.dev/posts/>Blog</a></li><li class=navigation-item><a class=navigation-link href=https://www.karun.dev/about/>About</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title>IntelliJ Live Templates With Groovy Script</h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fas fa-calendar"></i><time datetime=2022-08-05T19:00:00-07:00>August 5, 2022</time></span>
<span class=reading-time><i class="fas fa-clock"></i>4-minute read</span></div><div class=tags><i class="fas fa-tag"></i><a href=https://www.karun.dev/tags/programming/>programming</a>
<span class=separator>•</span>
<a href=https://www.karun.dev/tags/life-hacks/>life-hacks</a></div></div></header><div><p>Live Templates have made my programming life a lot easier. There is a lot of boilerplate code that we type every single day. I like using Groovy script to build some powerful Scala live templates.</p><p>Unfortunately the documentation for this is almost non existent. Oh well!</p><p>I ended up looking at the IntelliJ Scala plugin’s source to find the available variables for live templates. You can see it here - <a href=https://github.com/JetBrains/intellij-scala/blob/ddf0b94cc5f9802f66a73f140657a70b2d4719fd/scala/scala-impl/resources/liveTemplates/scala.xml>IntelliJ live template variables</a></p><p>Groovy scripts in templates are executed like this - <code>groovyScript(&lt;Script String>, [arg1, arg2...])</code></p><p>Instead of just talking about it, let us work through an example. We will build a live template to convert a simple case class into a Postgres table creation sql script. Imagine you had a case class like this -</p><div class=highlight><pre style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=color:green;font-weight:700>case</span> <span style=color:green;font-weight:700>class</span> <span style=color:#00f;font-weight:700>Person</span><span style=color:#666>(</span>
	firstName<span style=color:green;font-weight:700>:</span> <span style=color:#b00040>String</span><span style=color:#666>,</span> 
    lastName<span style=color:green;font-weight:700>:</span> <span style=color:#b00040>String</span><span style=color:#666>,</span>
    birthday<span style=color:green;font-weight:700>:</span> <span style=color:#b00040>LocalDate</span><span style=color:#666>,</span>
	address<span style=color:green;font-weight:700>:</span> <span style=color:#b00040>String</span><span style=color:#666>,</span> 
    zipCode<span style=color:green;font-weight:700>:</span> <span style=color:#b00040>String</span><span style=color:#666>,</span>
	phoneNumber<span style=color:green;font-weight:700>:</span> <span style=color:#b00040>String</span>
<span style=color:#666>)</span>
</code></pre></div><p>We will come up with an easy way turn this into -</p><div class=highlight><pre style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=color:green;font-weight:700>CREATE</span> <span style=color:green;font-weight:700>TABLE</span> person (
	first_name  <span style=color:green>VARCHAR</span>(x) <span style=color:green;font-weight:700>NOT</span> <span style=color:green;font-weight:700>NULL</span>,
    last_name   <span style=color:green>VARCHAR</span>(x) <span style=color:green;font-weight:700>NOT</span> <span style=color:green;font-weight:700>NULL</span>,
    birthday    <span style=color:green;font-weight:700>TIMESTAMP</span> <span style=color:green;font-weight:700>NOT</span> <span style=color:green;font-weight:700>NULL</span>,
    address     <span style=color:green>VARCHAR</span>(x) <span style=color:green;font-weight:700>NOT</span> <span style=color:green;font-weight:700>NULL</span>,
    zip_code    <span style=color:green>VARCHAR</span>(x) <span style=color:green;font-weight:700>NOT</span> <span style=color:green;font-weight:700>NULL</span>,
    phone_number <span style=color:green>VARCHAR</span>(x) <span style=color:green;font-weight:700>NOT</span> <span style=color:green;font-weight:700>NULL</span>
);
</code></pre></div><ul><li>Start by creating a live template: <strong>Preferences -> Editor -> Live Templates</strong></li><li>Click on Scala</li><li>Add a new template</li><li>Give it an abbreviation - pgtable</li><li>Give it a description</li><li>Select Scala as the applicable context so that it only shows up in Scala code</li><li>Click Apply just so you don&rsquo;t lose your changes accidentally</li><li>Add the following template text</li></ul><div class=highlight><pre style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>CREATE TABLE $TABLENAME$ (
	$FIELDS$
);
</code></pre></div><p><img src=https://www.karun.dev/images/LiveTemplateStep1.png alt="Step 1"></p><p>We have declared two variables - TABLENAME and FIELDS. We’ll have to define what they mean next. From the Scala plugin source above we can see two useful variables: <code>scala_className</code> and <code>scala_primaryConstructorParams</code>.</p><ul><li>Click on Edit Variables</li><li>Set snakeCase(scala_className) as the expression for the TABLENAME variable</li><li>This will put the snake cased version of the Scala class name in place of the TABLENAME variable. <a href=https://www.jetbrains.com/help/idea/template-variables.html#example_live_template_variables>These are the variables/functions that ship with IntelliJ</a></li><li>Now for the fun part. Let us build the groovy script that will output the fields with their types. We will use scala_primaryConstructorParams as our input to the groovy script. It outputs all the params with their types in a single string. For example if our case class had i: Int and j: String, it outputs <code>"i: Int, j: String</code></li><li>The simple way to achieve this is to<ul><li>Split the string on comma</li><li>Map over each item in the list</li><li>Split on <code>:</code> to get the field name and type</li><li>Lookup the sql type for each Scala type</li><li>Snake case the field</li><li>Write it out as <code>&lt;field> &lt;sql type> NOT NULL,</code> - We can work on optional values later</li><li>Join the strings with a new line</li></ul></li></ul><p>This will be our groovy script</p><div class=highlight><pre style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy>typesMap <span style=color:#666>=</span> <span style=color:#666>[</span><span style=color:#a0a000>Int:</span> <span style=color:#ba2121>&#39;INT&#39;</span><span style=color:#666>,</span> <span style=color:#a0a000>String:</span> <span style=color:#ba2121>&#39;VARCHAR(x)&#39;</span><span style=color:#666>,</span> <span style=color:#a0a000>LocalDate:</span> <span style=color:#ba2121>&#39;TIMESTAMP&#39;</span><span style=color:#666>].</span><span style=color:#7d9029>withDefault</span> <span style=color:#666>{</span> key <span style=color:#666>-&gt;</span> 
    key<span style=color:#666>.</span><span style=color:#7d9029>toLowerCase</span><span style=color:#666>()</span> 
<span style=color:#666>};</span>

<span style=color:#b00040>def</span> <span style=color:#00f>toSnakeCase</span><span style=color:#666>(</span>s<span style=color:#666>)</span> <span style=color:#666>{</span>
    <span style=color:green;font-weight:700>return</span> s<span style=color:#666>.</span><span style=color:#7d9029>replaceAll</span><span style=color:#666>(</span> <span style=color:#ba2121>/([A-Z])/</span><span style=color:#666>,</span> <span style=color:#ba2121>/_$1/</span> <span style=color:#666>).</span><span style=color:#7d9029>toLowerCase</span><span style=color:#666>().</span><span style=color:#7d9029>replaceAll</span><span style=color:#666>(</span> <span style=color:#ba2121>/^_/</span><span style=color:#666>,</span> <span style=color:#ba2121>&#39;&#39;</span> <span style=color:#666>);</span>
<span style=color:#666>};</span>

<span style=color:#b00040>def</span> <span style=color:#00f>toSql</span><span style=color:#666>(</span>fieldAndType<span style=color:#666>)</span> <span style=color:#666>{</span>
    split <span style=color:#666>=</span> fieldAndType<span style=color:#666>.</span><span style=color:#7d9029>tokenize</span><span style=color:#666>(</span><span style=color:#ba2121>&#39;:&#39;</span><span style=color:#666>);</span>
    field <span style=color:#666>=</span> split<span style=color:#666>[</span><span style=color:#666>0</span><span style=color:#666>].</span><span style=color:#7d9029>trim</span><span style=color:#666>();</span>
    scalaType <span style=color:#666>=</span> split<span style=color:#666>[</span><span style=color:#666>1</span><span style=color:#666>].</span><span style=color:#7d9029>trim</span><span style=color:#666>();</span>
    sqlType <span style=color:#666>=</span> typesMap<span style=color:#666>[</span>scalaType<span style=color:#666>];</span>
    <span style=color:green;font-weight:700>return</span> <span style=color:#00f>toSnakeCase</span><span style=color:#666>(</span>field<span style=color:#666>)</span> <span style=color:#666>+</span> <span style=color:#ba2121>&#39; &#39;</span> <span style=color:#666>+</span> sqlType <span style=color:#666>+</span> <span style=color:#ba2121>&#39; NOT NULL,&#39;</span><span style=color:#666>;</span>
<span style=color:#666>};</span>

tokens <span style=color:#666>=</span> _1<span style=color:#666>.</span><span style=color:#7d9029>tokenize</span><span style=color:#666>(</span><span style=color:#ba2121>&#39;,&#39;</span><span style=color:#666>);</span>
dbFields <span style=color:#666>=</span> tokens<span style=color:#666>.</span><span style=color:#7d9029>collect</span> <span style=color:#666>{</span> token <span style=color:#666>-&gt;</span> <span style=color:green;font-weight:700>return</span> toSql<span style=color:#666>(</span>token<span style=color:#666>.</span><span style=color:#7d9029>trim</span><span style=color:#666>())</span> <span style=color:#666>};</span>
sqlFields <span style=color:#666>=</span> dbFields<span style=color:#666>.</span><span style=color:#7d9029>join</span><span style=color:#666>(</span><span style=color:#ba2121>&#39; \\n &#39;</span><span style=color:#666>);</span>
<span style=color:green;font-weight:700>return</span> sqlFields<span style=color:#666>;</span>
</code></pre></div><ul><li><p>Now for the FIELDS variable use the groovy script above - `groovyScript(&ldquo;&rdquo;, scala_primaryConstructorParams);
<img src=https://www.karun.dev/images/LiveTemplateStep2.png alt="Step 2"></p></li><li><p>Unfortunately the place where you put this string in IntelliJ makes it a single line string. I wish they added a feature to make the editor bigger. So for now you have to end everything with a semicolon to make sure it works as a single line script</p></li><li><p>Save it. Your cursor needs to be in the context of the case class. So something like</p></li></ul><div class=highlight><pre style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala>    <span style=color:green;font-weight:700>case</span> <span style=color:green;font-weight:700>class</span> <span style=color:#00f;font-weight:700>Foo</span><span style=color:#666>()</span> <span style=color:#666>{</span>
        <span style=color:#666>&lt;</span>cursor goes here<span style=color:#666>&gt;</span>
    <span style=color:#666>}</span>
</code></pre></div><ul><li>Start typing the abbreviation, hit tab and it should put the sql script where your cursor is</li><li>Add more types to the typesMap if you like</li><li>Think about how you would deal with optional values, primary keys, etc</li><li>Write to <a href=https://www.jetbrains.com/idea/>Jetbrains</a> and ask them to make the script editor larger ¯\_(ツ)_/¯</li><li>Want to work on a better scripting plugin? Write to me :P</li></ul></div><footer></footer></article><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script type=text/javascript async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js id=MathJax-script></script><script>MathJax={tex:{inlineMath:[['$','$'],['\\(','\\)']],processEscapes:true,processEnvironments:true},options:{skipHtmlTags:['script','noscript','style','textarea','pre']}};</script></section></div><footer class=footer><section class=container>©
2023
Karun Ramakrishnan
·
Powered by <a href=https://gohugo.io/>Hugo</a> & <a href=https://github.com/luizdepra/hugo-coder/>Coder</a>.</section></footer></main></body></html>