<!doctype html><html lang=en-us class=scroll-smooth><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Full Stack Software Engineer"><meta name=view-transition content="same-origin"><title>Lessons from TDD - Logic in unit tests | Karun Ramakrishnan</title>
<link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel=stylesheet><link rel=icon type=image/png sizes=32x32 href=https://www.karun.dev/images/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://www.karun.dev/images/favicon-16x16.png><link rel=stylesheet href=https://www.karun.dev/css/dist/main.css><script>(function(){const e=localStorage.getItem("theme");(e==="dark"||!e&&window.matchMedia("(prefers-color-scheme: dark)").matches)&&document.documentElement.classList.add("dark")})()</script></head><body class="min-h-screen flex flex-col antialiased"><div id=progress-bar class=progress-bar style=width:0%></div><header class=w-full><nav class="max-w-3xl mx-auto px-6 h-16 flex items-center justify-end gap-6"><a href=https://www.karun.dev/posts/ class="text-sm text-secondary hover:text-[var(--text-primary)] transition-colors">Blog
</a><a href=https://www.karun.dev/resume/ class="text-sm text-secondary hover:text-[var(--text-primary)] transition-colors">Resume
</a><a href=https://www.karun.dev/about/ class="text-sm text-secondary hover:text-[var(--text-primary)] transition-colors">About
</a><button id=search-btn class="hidden sm:flex items-center gap-2 text-sm text-secondary hover:text-[var(--text-primary)] transition-colors" aria-label=Search>
<svg class="w-4 h-4" fill="none" stroke="currentcolor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M21 21l-6-6m2-5A7 7 0 113 10a7 7 0 0114 0z"/></svg>
<span class="text-xs px-1.5 py-0.5 rounded bg-[var(--surface)] border border-[var(--border)]">⌘K</span>
</button>
<button id=search-btn-mobile class="sm:hidden text-secondary hover:text-[var(--text-primary)] transition-colors" aria-label=Search>
<svg class="w-5 h-5" fill="none" stroke="currentcolor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M21 21l-6-6m2-5A7 7 0 113 10a7 7 0 0114 0z"/></svg>
</button>
<button id=theme-toggle class=theme-toggle aria-label="Toggle theme"><svg class="w-5 h-5 hidden dark:block" fill="none" stroke="currentcolor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364-.707-.707M6.343 6.343l-.707-.707m12.728.0-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"/></svg><svg class="w-5 h-5 block dark:hidden" fill="none" stroke="currentcolor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003.0 0012 21a9.003 9.003.0 008.354-5.646z"/></svg></button></nav></header><main class="flex-1 w-full max-w-3xl mx-auto px-6 py-12"><article><header class=mb-8><nav class="text-sm text-secondary mb-4"><a href=https://www.karun.dev/ class=hover:opacity-60>Home</a>
<span class=mx-2>/</span>
<a href=https://www.karun.dev/posts class=hover:opacity-60>Posts</a></nav><h1 class="text-3xl sm:text-4xl font-semibold mb-4 tracking-tight">Lessons from TDD - Logic in unit tests</h1><div class="flex flex-wrap items-center gap-3 text-sm text-secondary"><time datetime=2020-07-20>July 20, 2020
</time><span>&#183;</span>
<span>3 min read</span>
<span>&#183;</span>
<span>606 words</span></div><div class="flex flex-wrap gap-2 mt-4"><a href=https://www.karun.dev/tags/programming class="px-3 py-1 text-sm rounded-full bg-[var(--surface)] text-secondary hover:opacity-60 transition-opacity">programming
</a><a href=https://www.karun.dev/tags/tdd class="px-3 py-1 text-sm rounded-full bg-[var(--surface)] text-secondary hover:opacity-60 transition-opacity">TDD
</a><a href=https://www.karun.dev/tags/scala class="px-3 py-1 text-sm rounded-full bg-[var(--surface)] text-secondary hover:opacity-60 transition-opacity">scala
</a><a href=https://www.karun.dev/tags/scalatest class="px-3 py-1 text-sm rounded-full bg-[var(--surface)] text-secondary hover:opacity-60 transition-opacity">scalatest</a></div></header><div class="prose prose-lg max-w-none"><blockquote><p><strong>TL;DR</strong> - Try not to have logic in unit tests. The whole point of a unit test is to make sure some logic works</p></blockquote><p>TDD was something new to me about 8 years ago. I worked as a test automation engineer for a large corporation during my internship. My job was to automate integration tests. When I became a full time developer and starting writing production code, I learned about TDD. I realized that it&rsquo;s one of the best tools that I had ever come across. Since then my mantra has been red-green-refactor. I have met newer engineers who ask the question - why test it if it works?</p><p>If you work in a large codebase, you&rsquo;ll realize that refactoring an existing system is relatively crazier if it has a lack of test coverage. Especially when the code is business critical. Having a well tested system gives you way more confidence in refactoring since you know that if you mess something up, there will most likely be a test case that fails. Now, I&rsquo;m not saying that if all tests pass, the system functions as expected. That&rsquo;s not guaranteed unless all tests were written correctly. I&rsquo;ve seen tests that are wrong which result in wrong code. With enough test coverage, at least I don&rsquo;t have to take the car out for a spin every time I tighten a screw.</p><p>One of the biggest flaws I have seen in testing is the use of logic in tests. The purpose of a test is to make sure a certain piece of code works the way it is supposed to. The moment you add some logic in the test, the test starts to become complex. Here are two fun things I&rsquo;ve learned -</p><h3 id=loops-around-tests>Loops around tests</h3><p>I have come across test suites where a bunch of test methods are wrapped in a loop. Think of tests for a generic DAO that works with multiple tables. If you want to make sure it works with all the tables, do not wrap all the tests in loop and execute them against the tables.</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>FooDao</span><span style=color:#ff7b72;font-weight:700>(</span><span style=color:#ff7b72>val</span> table<span style=color:#ff7b72>:</span> <span style=color:#ff7b72>String</span><span style=color:#ff7b72;font-weight:700>)</span> <span style=color:#ff7b72;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> writeStuff<span style=color:#ff7b72;font-weight:700>(</span>stuff<span style=color:#ff7b72>:</span> <span style=color:#ff7b72>Stuff</span><span style=color:#ff7b72;font-weight:700>)</span><span style=color:#ff7b72>:</span> <span style=color:#ff7b72>Unit</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> readStuff<span style=color:#ff7b72;font-weight:700>()</span><span style=color:#ff7b72>:</span> <span style=color:#ff7b72>Seq</span><span style=color:#ff7b72;font-weight:700>[</span><span style=color:#ff7b72>Stuff</span><span style=color:#ff7b72;font-weight:700>]</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>FooTest</span> <span style=color:#ff7b72>extends</span> <span style=color:#f0883e;font-weight:700>FunSuite</span> <span style=color:#ff7b72>with</span> <span style=color:#f0883e;font-weight:700>Matchers</span> <span style=color:#ff7b72;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#f0883e;font-weight:700>Seq</span><span style=color:#ff7b72;font-weight:700>(</span><span style=color:#a5d6ff>&#34;tableA&#34;</span><span style=color:#ff7b72;font-weight:700>,</span> <span style=color:#a5d6ff>&#34;tableB&#34;</span><span style=color:#ff7b72;font-weight:700>,</span> <span style=color:#a5d6ff>&#34;tableC&#34;</span><span style=color:#ff7b72;font-weight:700>).</span>forEach <span style=color:#ff7b72;font-weight:700>{</span> table <span style=color:#ff7b72>=&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>val</span> dao <span style=color:#ff7b72>=</span> <span style=color:#ff7b72>new</span> <span style=color:#f0883e;font-weight:700>FooDao</span><span style=color:#ff7b72;font-weight:700>(</span>table<span style=color:#ff7b72;font-weight:700>)</span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic>//test write
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>        <span style=color:#8b949e;font-style:italic>//test read
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    <span style=color:#ff7b72;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72;font-weight:700>}</span>
</span></span></code></pre></div><p>At least in Intellij if you run one of the tests independently, it&rsquo;ll tell youthat the test passed. But try putting a failing assertion in it and you&rsquo;ll notice that the test does not actually run. The correct way to write this test is to use shared behavior - <a href=https://www.scalatest.org/user_guide/sharing_tests>https://www.scalatest.org/user_guide/sharing_tests</a>.</p><h3 id=conditions-in-test-code>Conditions in test code</h3><p>It is harder to follow test code that has conditional logic. Conditionals imply that you need to have multiple tests/suites instead. If your test has conditions, is there test code that tests you test?</p><p>Take the case of beta features. If you have certain tests that need to work when a beta feature is turned on, and all other tests need to work in both cases, it&rsquo;s always best to duplicate the tests and have one test that covers all the cases plus the ones specific for the beta feature, and another that does not have the tests for the beta feature but specifically turns it off for testing. That way when your beta feature code is cleaned up, you just have to delete the old test and not worry about whether or not you deleted too much.</p><p>There are many more little things you can do to avoid having logic in tests. These are the two most important ones that I have come across a lot.</p></div><nav class="mt-16 pt-8"><div class="flex flex-col sm:flex-row justify-between gap-4"><a href=https://www.karun.dev/posts/premature-abstraction/ class="group flex-1 text-right"><span class="text-sm text-secondary">Next</span><p class="font-medium group-hover:opacity-60 transition-opacity">Premature abstraction</p></a></div></nav></article></main><footer class=w-full><div class="max-w-3xl mx-auto px-6 py-8 flex flex-col sm:flex-row items-center justify-between gap-4"><p class="text-sm text-secondary">&copy; 2026 Karun Ramakrishnan</p><div class="flex items-center gap-4"><a href=https://github.com/karun012/ target=_blank rel="noopener noreferrer" class="text-secondary hover:text-[var(--text-primary)] transition-colors" aria-label=Github><svg class="w-5 h-5" fill="currentcolor" viewBox="0 0 24 24"><path d="M12 0C5.374.0.0 5.373.0 12c0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931.0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176.0.0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221.0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576C20.566 21.797 24 17.3 24 12c0-6.627-5.373-12-12-12z"/></svg>
</a><a href=https://www.linkedin.com/in/karunramakrishnan/ target=_blank rel="noopener noreferrer" class="text-secondary hover:text-[var(--text-primary)] transition-colors" aria-label=LinkedIn><svg class="w-5 h-5" fill="currentcolor" viewBox="0 0 24 24"><path d="M19 0H5C2.239.0.0 2.239.0 5v14c0 2.761 2.239 5 5 5h14c2.762.0 5-2.239 5-5V5c0-2.761-2.238-5-5-5zM8 19H5V8h3v11zM6.5 6.732c-.966.0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zM20 19h-3v-5.604c0-3.368-4-3.113-4 0V19h-3V8h3v1.765c1.396-2.586 7-2.777 7 2.476V19z"/></svg></a></div></div></footer><button id=back-to-top class=back-to-top aria-label="Back to top"><svg fill="none" stroke="currentcolor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0 7 7m-7-7v18"/></svg></button><div id=lightbox-backdrop class=lightbox-backdrop></div><img id=lightbox-img class=lightbox-img src alt><div id=cmd-backdrop class=cmd-palette-backdrop></div><div id=cmd-palette class=cmd-palette><input type=text id=cmd-input class=cmd-palette-input placeholder="Search posts..." autocomplete=off><div id=cmd-results class=cmd-palette-results></div><div class=cmd-palette-hint><span><kbd>↑</kbd><kbd>↓</kbd> Navigate</span>
<span><kbd>↵</kbd> Open</span>
<span><kbd>esc</kbd> Close</span></div></div><script src=https://cdn.jsdelivr.net/npm/fuse.js@7.0.0/dist/fuse.min.js></script><script src=https://www.karun.dev/js/main.js></script><script src=https://www.karun.dev/js/search.js></script></body></html>