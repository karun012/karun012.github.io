<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Lessons from TDD - Logic in unit tests | Karun Ramakrishnan</title>
<meta name=keywords content="programming,TDD,scala,scalatest"><meta name=description content="
TL;DR - Try not to have logic in unit tests. The whole point of a unit test is to make sure some logic works
TDD was something new to me about 8 years ago. I worked as a test automation engineer for a large corporation during my internship. My job was to automate integration tests. When I became a full time developer and starting writing production code, I learned about TDD. I realized that it&rsquo;s one of the best tools that I had ever come across. Since then my mantra has been red-green-refactor. I have met newer engineers who ask the question - why test it if it works?"><meta name=author content="Karun Ramakrishnan"><link rel=canonical href=https://www.karun.dev/posts/test-the-test/><link crossorigin=anonymous href=https://www.karun.dev/assets/css/stylesheet.f49d66caae9ea0fd43f21f29e71a8d3e284517ed770f2aa86fa012953ad3c9ef.css integrity="sha256-9J1myq6eoP1D8h8p5xqNPihFF+13Dyqob6ASlTrTye8=" rel="preload stylesheet" as=style><link rel=icon href=https://www.karun.dev/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://www.karun.dev/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://www.karun.dev/favicon-32x32.png><link rel=apple-touch-icon href=https://www.karun.dev/apple-touch-icon.png><link rel=mask-icon href=https://www.karun.dev/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://www.karun.dev/posts/test-the-test/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://www.karun.dev/posts/test-the-test/"><meta property="og:site_name" content="Karun Ramakrishnan"><meta property="og:title" content="Lessons from TDD - Logic in unit tests"><meta property="og:description" content=" TL;DR - Try not to have logic in unit tests. The whole point of a unit test is to make sure some logic works
TDD was something new to me about 8 years ago. I worked as a test automation engineer for a large corporation during my internship. My job was to automate integration tests. When I became a full time developer and starting writing production code, I learned about TDD. I realized that it’s one of the best tools that I had ever come across. Since then my mantra has been red-green-refactor. I have met newer engineers who ask the question - why test it if it works?"><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-07-20T12:28:17-07:00"><meta property="article:modified_time" content="2020-07-20T12:28:17-07:00"><meta property="article:tag" content="Programming"><meta property="article:tag" content="TDD"><meta property="article:tag" content="Scala"><meta property="article:tag" content="Scalatest"><meta name=twitter:card content="summary"><meta name=twitter:title content="Lessons from TDD - Logic in unit tests"><meta name=twitter:description content="
TL;DR - Try not to have logic in unit tests. The whole point of a unit test is to make sure some logic works
TDD was something new to me about 8 years ago. I worked as a test automation engineer for a large corporation during my internship. My job was to automate integration tests. When I became a full time developer and starting writing production code, I learned about TDD. I realized that it&rsquo;s one of the best tools that I had ever come across. Since then my mantra has been red-green-refactor. I have met newer engineers who ask the question - why test it if it works?"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://www.karun.dev/posts/"},{"@type":"ListItem","position":2,"name":"Lessons from TDD - Logic in unit tests","item":"https://www.karun.dev/posts/test-the-test/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Lessons from TDD - Logic in unit tests","name":"Lessons from TDD - Logic in unit tests","description":" TL;DR - Try not to have logic in unit tests. The whole point of a unit test is to make sure some logic works\nTDD was something new to me about 8 years ago. I worked as a test automation engineer for a large corporation during my internship. My job was to automate integration tests. When I became a full time developer and starting writing production code, I learned about TDD. I realized that it\u0026rsquo;s one of the best tools that I had ever come across. Since then my mantra has been red-green-refactor. I have met newer engineers who ask the question - why test it if it works?\n","keywords":["programming","TDD","scala","scalatest"],"articleBody":" TL;DR - Try not to have logic in unit tests. The whole point of a unit test is to make sure some logic works\nTDD was something new to me about 8 years ago. I worked as a test automation engineer for a large corporation during my internship. My job was to automate integration tests. When I became a full time developer and starting writing production code, I learned about TDD. I realized that it’s one of the best tools that I had ever come across. Since then my mantra has been red-green-refactor. I have met newer engineers who ask the question - why test it if it works?\nIf you work in a large codebase, you’ll realize that refactoring an existing system is relatively crazier if it has a lack of test coverage. Especially when the code is business critical. Having a well tested system gives you way more confidence in refactoring since you know that if you mess something up, there will most likely be a test case that fails. Now, I’m not saying that if all tests pass, the system functions as expected. That’s not guaranteed unless all tests were written correctly. I’ve seen tests that are wrong which result in wrong code. With enough test coverage, at least I don’t have to take the car out for a spin every time I tighten a screw.\nOne of the biggest flaws I have seen in testing is the use of logic in tests. The purpose of a test is to make sure a certain piece of code works the way it is supposed to. The moment you add some logic in the test, the test starts to become complex. Here are two fun things I’ve learned -\nLoops around tests I have come across test suites where a bunch of test methods are wrapped in a loop. Think of tests for a generic DAO that works with multiple tables. If you want to make sure it works with all the tables, do not wrap all the tests in loop and execute them against the tables.\nclass FooDao(val table: String) { def writeStuff(stuff: Stuff): Unit def readStuff(): Seq[Stuff] } class FooTest extends FunSuite with Matchers { Seq(\"tableA\", \"tableB\", \"tableC\").forEach { table =\u003e val dao = new FooDao(table) //test write //test read } } At least in Intellij if you run one of the tests independently, it’ll tell youthat the test passed. But try putting a failing assertion in it and you’ll notice that the test does not actually run. The correct way to write this test is to use shared behavior - https://www.scalatest.org/user_guide/sharing_tests.\nConditions in test code It is harder to follow test code that has conditional logic. Conditionals imply that you need to have multiple tests/suites instead. If your test has conditions, is there test code that tests you test?\nTake the case of beta features. If you have certain tests that need to work when a beta feature is turned on, and all other tests need to work in both cases, it’s always best to duplicate the tests and have one test that covers all the cases plus the ones specific for the beta feature, and another that does not have the tests for the beta feature but specifically turns it off for testing. That way when your beta feature code is cleaned up, you just have to delete the old test and not worry about whether or not you deleted too much.\nThere are many more little things you can do to avoid having logic in tests. These are the two most important ones that I have come across a lot.\n","wordCount":"606","inLanguage":"en","datePublished":"2020-07-20T12:28:17-07:00","dateModified":"2020-07-20T12:28:17-07:00","author":{"@type":"Person","name":"Karun Ramakrishnan"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://www.karun.dev/posts/test-the-test/"},"publisher":{"@type":"Organization","name":"Karun Ramakrishnan","logo":{"@type":"ImageObject","url":"https://www.karun.dev/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://www.karun.dev/ accesskey=h title="Karun Ramakrishnan (Alt + H)">Karun Ramakrishnan</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://www.karun.dev/posts/ title=Blog><span>Blog</span></a></li><li><a href=https://www.karun.dev/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://www.karun.dev/about/ title=About><span>About</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://www.karun.dev/>Home</a>&nbsp;»&nbsp;<a href=https://www.karun.dev/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">Lessons from TDD - Logic in unit tests</h1><div class=post-meta><span title='2020-07-20 12:28:17 -0700 -0700'>July 20, 2020</span>&nbsp;·&nbsp;3 min&nbsp;·&nbsp;606 words&nbsp;·&nbsp;Karun Ramakrishnan</div></header><div class=post-content><blockquote><p><strong>TL;DR</strong> - Try not to have logic in unit tests. The whole point of a unit test is to make sure some logic works</p></blockquote><p>TDD was something new to me about 8 years ago. I worked as a test automation engineer for a large corporation during my internship. My job was to automate integration tests. When I became a full time developer and starting writing production code, I learned about TDD. I realized that it&rsquo;s one of the best tools that I had ever come across. Since then my mantra has been red-green-refactor. I have met newer engineers who ask the question - why test it if it works?</p><p>If you work in a large codebase, you&rsquo;ll realize that refactoring an existing system is relatively crazier if it has a lack of test coverage. Especially when the code is business critical. Having a well tested system gives you way more confidence in refactoring since you know that if you mess something up, there will most likely be a test case that fails. Now, I&rsquo;m not saying that if all tests pass, the system functions as expected. That&rsquo;s not guaranteed unless all tests were written correctly. I&rsquo;ve seen tests that are wrong which result in wrong code. With enough test coverage, at least I don&rsquo;t have to take the car out for a spin every time I tighten a screw.</p><p>One of the biggest flaws I have seen in testing is the use of logic in tests. The purpose of a test is to make sure a certain piece of code works the way it is supposed to. The moment you add some logic in the test, the test starts to become complex. Here are two fun things I&rsquo;ve learned -</p><h3 id=loops-around-tests>Loops around tests<a hidden class=anchor aria-hidden=true href=#loops-around-tests>#</a></h3><p>I have come across test suites where a bunch of test methods are wrapped in a loop. Think of tests for a generic DAO that works with multiple tables. If you want to make sure it works with all the tables, do not wrap all the tests in loop and execute them against the tables.</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>FooDao</span><span style=color:#ff7b72;font-weight:700>(</span><span style=color:#ff7b72>val</span> table<span style=color:#ff7b72>:</span> <span style=color:#ff7b72>String</span><span style=color:#ff7b72;font-weight:700>)</span> <span style=color:#ff7b72;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> writeStuff<span style=color:#ff7b72;font-weight:700>(</span>stuff<span style=color:#ff7b72>:</span> <span style=color:#ff7b72>Stuff</span><span style=color:#ff7b72;font-weight:700>)</span><span style=color:#ff7b72>:</span> <span style=color:#ff7b72>Unit</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> readStuff<span style=color:#ff7b72;font-weight:700>()</span><span style=color:#ff7b72>:</span> <span style=color:#ff7b72>Seq</span><span style=color:#ff7b72;font-weight:700>[</span><span style=color:#ff7b72>Stuff</span><span style=color:#ff7b72;font-weight:700>]</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>FooTest</span> <span style=color:#ff7b72>extends</span> <span style=color:#f0883e;font-weight:700>FunSuite</span> <span style=color:#ff7b72>with</span> <span style=color:#f0883e;font-weight:700>Matchers</span> <span style=color:#ff7b72;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#f0883e;font-weight:700>Seq</span><span style=color:#ff7b72;font-weight:700>(</span><span style=color:#a5d6ff>&#34;tableA&#34;</span><span style=color:#ff7b72;font-weight:700>,</span> <span style=color:#a5d6ff>&#34;tableB&#34;</span><span style=color:#ff7b72;font-weight:700>,</span> <span style=color:#a5d6ff>&#34;tableC&#34;</span><span style=color:#ff7b72;font-weight:700>).</span>forEach <span style=color:#ff7b72;font-weight:700>{</span> table <span style=color:#ff7b72>=&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>val</span> dao <span style=color:#ff7b72>=</span> <span style=color:#ff7b72>new</span> <span style=color:#f0883e;font-weight:700>FooDao</span><span style=color:#ff7b72;font-weight:700>(</span>table<span style=color:#ff7b72;font-weight:700>)</span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic>//test write
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>        <span style=color:#8b949e;font-style:italic>//test read
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    <span style=color:#ff7b72;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72;font-weight:700>}</span>
</span></span></code></pre></div><p>At least in Intellij if you run one of the tests independently, it&rsquo;ll tell youthat the test passed. But try putting a failing assertion in it and you&rsquo;ll notice that the test does not actually run. The correct way to write this test is to use shared behavior - <a href=https://www.scalatest.org/user_guide/sharing_tests>https://www.scalatest.org/user_guide/sharing_tests</a>.</p><h3 id=conditions-in-test-code>Conditions in test code<a hidden class=anchor aria-hidden=true href=#conditions-in-test-code>#</a></h3><p>It is harder to follow test code that has conditional logic. Conditionals imply that you need to have multiple tests/suites instead. If your test has conditions, is there test code that tests you test?</p><p>Take the case of beta features. If you have certain tests that need to work when a beta feature is turned on, and all other tests need to work in both cases, it&rsquo;s always best to duplicate the tests and have one test that covers all the cases plus the ones specific for the beta feature, and another that does not have the tests for the beta feature but specifically turns it off for testing. That way when your beta feature code is cleaned up, you just have to delete the old test and not worry about whether or not you deleted too much.</p><p>There are many more little things you can do to avoid having logic in tests. These are the two most important ones that I have come across a lot.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://www.karun.dev/tags/programming/>Programming</a></li><li><a href=https://www.karun.dev/tags/tdd/>TDD</a></li><li><a href=https://www.karun.dev/tags/scala/>Scala</a></li><li><a href=https://www.karun.dev/tags/scalatest/>Scalatest</a></li></ul><nav class=paginav><a class=prev href=https://www.karun.dev/posts/premature-abstraction/><span class=title>« Prev</span><br><span>Premature abstraction</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://www.karun.dev/>Karun Ramakrishnan</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>